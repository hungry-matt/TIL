# 의존성 관리 이해
스프링 부트에서는 의존성을 정의할 때 버전을 명시 하지 않아도 적절한 버전으로 가져온다.

의존성 관리는 다음과 같이 pom.xml 에서 `spring-boot-starter-parent`를 추가해 주면 인코딩 설정, 자바 버전 등의 third-party 라이브러리 버전을 명시하지 않아도 자동으로 설정해준다.

![image](https://user-images.githubusercontent.com/45548349/118984119-20c78600-b9b8-11eb-96b6-1680123393e0.png)

스프링에서는 새로운 의존성을 추가할 때 현재 스프링 버전과 호환이 되는지 확인 작업을 했어야 했다.

그런데 스프링 부트에서는 이런 작업을 하지 않아도 다음과 같이 `spring-boot-dependencies.pom` 에서 스프링 부트 버전에 최적화된 의존성들의 버전을 자동으로 관리해주고 있다.

![image](https://user-images.githubusercontent.com/45548349/118983834-cfb79200-b9b7-11eb-9ac7-9a664ba31737.png)

이렇게 의존성 관리에는 개발자가 관리해야하는 의존성이 줄어드는 장점이 있다.

# 의존성 관리 응용

스프링 부트에서 `지원하지 않는 의존성`을 추가 하는 경우 다음과 같이 버전을 반드시 명시해야 한다.

![image](https://user-images.githubusercontent.com/45548349/118989216-d268b600-b9bc-11eb-872b-50c12117d8d9.png)

`지원되고 있는 의존성`의 버전을 변경 하고 싶을때는 다음과 같이 `properties`에 버전을 추가하면 일괄적으로 변경된다.

![image](https://user-images.githubusercontent.com/45548349/118990418-d517db00-b9bd-11eb-9528-3481fa5b8562.png)

# 자동 설정 이해

스프링 부트에서 웹 애플리케이션이 실행되는 지점인 메인 클래스의 형태는 다음과 같다.

```java
@SpringBootApplication
public class Application {
    public static void main(String[] args) {
        SpringApplication.run(Application.class);
    }
}
```

여기서 @SpringBootApplication은 다음 3개의 애노테이션과 합쳐진 것이다.

- @SpringBootConfiguration 
- @ComponentScan
- @EnableAutoConfiguration

스프링 애플리케이션이 실행될때 빈을 두 단계로 나누어 읽는다.

먼저 @ComponentScan이 빈을 등록하고 @EnableAutoConfiguration이 추가적으로 빈을 등록하게 된다.

## @ComponentScan

@ComponentScan은 자신이 속해 있는 패키지와 하위 패키지에서 다음 애노테이션들이 선언된 클래스들을 스캔하여 빈으로 등록한다.

- @Component
- @Controller, @RestController, @Service, @Repository, @Configuration

## @EnableAutoConfiguration

@EnableAutoConfiguration은 Spring Boot에서 spring.factories 파일에 사전에 정의한 AutoConfiguration 설정에 따라 빈을 등록한다.

- spring.factories
    - Spring Boot에서 사전에 정의한 내용은 아래 경로에서 확인할 수 있다.
    - spring-boot-autoconfigure/META-INF/spring.factories
    - org.springframework.boot.autoconfigure.EnableAutoConfiguration
- @Configuration
- @ConditionalOnXxxYyyZzz
    - 사전에 정의된 수많은 configuration을 전부 빈으로 등록하는건 아니다.
    - 각 각의 configuration은 빈으로 등록되기 위한 조건이 있고 조건에 따라 등록이 되거나 되지 않기도 한다.

# 자동 설정 구현

Custom AutoConfigure 프로젝트 구성은 다음과 같다.

## Starter와 AutoConfigure

프로젝트명은 아래와 같은 규칙을 가진다.

- Xxx-Spring-Boot-Autoconfigure 모듈 : 자동설정
- Xxx-Spring-Boot-Starter 모듈 : 필요한 의존성 정의
    - pom 파일이 핵심이며 소스코드가 없는 경우가 있다.
    - 두 개의 모듈을 나누지 않고 하나로 만들때 사용된다.

## 필수 의존성 추가

xxx-spring-boot-starter 프로젝트를 생성하고 아래의 의존성을 추가 한다.

```xml
<!-- custom configuration 만들기 위한 의존성 추가-->
<dependencies>
  <dependency>
      <groupId>org.springframework.boot</groupId>
      <artifactId>spring-boot-autoconfigure</artifactId>
  </dependency>
  <dependency>
      <groupId>org.springframework.boot</groupId>
      <artifactId>spring-boot-autoconfigure-processor</artifactId>
      <optional>true</optional>
  </dependency>
</dependencies>

<!-- dependencies 버전관리를 위해 추가 -->
<dependencyManagement>
  <dependencies>
      <dependency>
          <groupId>org.springframework.boot</groupId>
          <artifactId>spring-boot-dependencies</artifactId>
          <version>2.0.3.RELEASE</version>
          <type>pom</type>
          <scope>import</scope>
      </dependency>
  </dependencies>
</dependencyManagement>
```
